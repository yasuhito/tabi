#!/usr/bin/env ruby
# -*- coding: utf-8 -*-
# 1.9 adds realpath to resolve symlinks; 1.8 doesn't
# have this method, so we add it so we get resolved symlinks
# and compatibility
unless File.respond_to? :realpath
  class File #:nodoc:
    def self.realpath path
      return realpath(File.readlink(path)) if symlink?(path)
      path
    end
  end
end
$: << File.expand_path(File.dirname(File.realpath(__FILE__)) + "/../lib")
require "rubygems"
require "gli"
require "tabi_version"

include GLI

program_desc "tabi クラウドルータ管理コマンド"

version Tabi::VERSION


desc "接続許可待ちのユーザを表示"
long_desc """
インターネットへの接続許可待ちのユーザ一覧を表示する。
ユーザは allow コマンドで接続を許可、または deny コマンドで禁止することができる。
"""
command :pending do | c |
  c.action do | global_options, options, args |
    # If you have any errors, just raise them
    # raise "that command made no sense"
    #
    # [TODO] 余計な引数が与えられたときのエラー処理

    $LOAD_PATH.unshift File.expand_path( File.join File.dirname( __FILE__ ), ".." )
    require "config"

    Dir.glob( File.join( pending_dir, "*" ) ).each do | each |
      puts File.basename( each )
    end
  end
end


desc "ユーザの接続を許可"
arg_name "Describe arguments to allow here"
command :allow do |c|
  c.action do |global_options,options,args|
  end
end


desc "ユーザの接続を禁止"
arg_name "Describe arguments to deny here"
command :deny do |c|
  c.action do |global_options,options,args|
  end
end


pre do |global,command,options,args|
  # Pre logic here
  # Return true to proceed; false to abort and not call the
  # chosen command
  # Use skips_pre before a command to skip this block
  # on that command only
  true
end

post do |global,command,options,args|
  # Post logic here
  # Use skips_post before a command to skip this
  # block on that command only
end

on_error do |exception|
  # Error logic here
  # return false to skip default error handling
  true
end

exit GLI.run(ARGV)
